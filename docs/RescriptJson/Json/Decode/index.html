<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Decode (RescriptJson.Json.Decode)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../">Up</a> – <a href="../../">RescriptJson</a> &#x00BB; <a href="../">Json</a> &#x00BB; Decode</nav><h1>Module <code>Json.Decode</code></h1><nav class="toc"><ul><li><a href="#header">Turn JSON values into Rescript values</a><ul><li><a href="#primatives">Primatives</a></li><li><a href="#data-structures">Data Structures</a></li><li><a href="#obj-primatives">Object Primatives</a></li><li><a href="#inconsisent-structur">Inconsistent Structure</a></li><li><a href="#run-decoders">Run Decoders</a></li><li><a href="#combine">Combine</a></li><li><a href="#fancy">Fancy</a></li></ul></li></ul></nav></header><section><header><h2 id="header"><a href="#header" class="anchor"></a>Turn JSON values into Rescript values</h2></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span class="keyword">nonrec</span> t('a)</code>;</dt></dl><aside><p>A value that knows how to decode JSON values.</p></aside><section><header><h3 id="primatives"><a href="#primatives" class="anchor"></a>Primatives</h3></header><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">let</span> string: <a href="#type-t">t</a>(string);</code></dt></dl><aside><p>Decode a JSON string into a Rescript <code>string</code>.</p><pre><code class="ml">decodeString(string, &quot;true&quot;)               == Error(...)
decodeString(string, &quot;42&quot;)                 == Error(...)
decodeString(string, &quot;3.14&quot;)               == Error(...)
decodeString(string, &quot;\&quot;hello\&quot;&quot;)          == Ok(&quot;hello&quot;)
decodeString(string, &quot;{ \&quot;hello\&quot;: 42 }&quot;)  == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span class="keyword">let</span> bool: <a href="#type-t">t</a>(bool);</code></dt></dl><aside><p>Decode a JSON bool into a Rescript <code>bool</code>.</p><pre><code class="ml">decodeString(bool, &quot;true&quot;)                == Ok(true)
decodeString(bool, &quot;42&quot;)                  == Error(...)
decodeString(bool, &quot;3.14&quot;)                == Error(...)
decodeString(bool, &quot;\&quot;hello\&quot;&quot;)           == Error(...)
decodeString(bool, &quot;{ \&quot;hello\&quot;: 42 }&quot;)   == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-int"><a href="#val-int" class="anchor"></a><code><span class="keyword">let</span> int: <a href="#type-t">t</a>(int);</code></dt></dl><aside><p>Decode a JSON int into a Rescript <code>int</code>.</p><pre><code class="ml">decodeString(int, &quot;true&quot;)              == Error(...)
decodeString(int, &quot;42&quot;)                == Ok(42)
decodeString(int, &quot;3.14&quot;)              == Error(...)
decodeString(int, &quot;\&quot;hello\&quot;&quot;)         == Error(...)
decodeString(int, &quot;{ \&quot;hello\&quot;: 42 }&quot;) == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-float"><a href="#val-float" class="anchor"></a><code><span class="keyword">let</span> float: <a href="#type-t">t</a>(float);</code></dt></dl><aside><p>Decode a JSON float into a Rescript <code>float</code>.</p><pre><code class="ml">decodeString(float, &quot;true&quot;)              == Error(...)
decodeString(float, &quot;42&quot;)                == Error(...)
decodeString(float, &quot;3.14&quot;)              == Ok(3.14)
decodeString(float, &quot;\&quot;hello\&quot;&quot;)         == Error(...)
decodeString(float, &quot;{ \&quot;hello\&quot;: 42 }&quot;) == Error(...)</code></pre></aside></section><section><header><h3 id="data-structures"><a href="#data-structures" class="anchor"></a>Data Structures</h3></header><dl><dt class="spec value" id="val-nullable"><a href="#val-nullable" class="anchor"></a><code><span class="keyword">let</span> nullable: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(option(<span class="type-var">'a</span>));</code></dt></dl><aside><p>Decode a nullable JSON value into a Rescript value.</p><pre><code class="ml">decodeString(nullable(int), &quot;13&quot;)   == Ok(Some(13))
decodeString(nullable(int), &quot;42&quot;)   == Ok(Some(42))
decodeString(nullable(int), &quot;null&quot;) == Ok(None)
decodeString(nullable(int), &quot;true&quot;) == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">let</span> array: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(array(<span class="type-var">'a</span>));</code></dt></dl><aside><p>Decode a JSON value into a Rescript <code>array</code>.</p><pre><code class="ml">decodeString(array(int), &quot;[1,2,3]&quot;)       == Ok([1, 2, 3])
decodeString(array(bool), &quot;[true,false]&quot;) == Ok([true, false])</code></pre></aside><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">let</span> list: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(list(<span class="type-var">'a</span>));</code></dt></dl><aside><p>Decode a JSON value into a Rescript <code>list</code>.</p><pre><code class="ml">decodeString(list(int), &quot;[1,2,3]&quot;)       == Ok(list{1, 2, 3})
decodeString(list(bool), &quot;[true,false]&quot;) == Ok(list{true, false})</code></pre></aside><dl><dt class="spec value" id="val-dict"><a href="#val-dict" class="anchor"></a><code><span class="keyword">let</span> dict: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(Js.Dict.t(<span class="type-var">'a</span>));</code></dt></dl><aside><p>Decode a JSON value into a Rescript <code>Js.Dict.t</code>.</p><pre><code class="ml">decodeString(dict(int), &quot;{ \&quot;alice\&quot;: 42, \&quot;bob\&quot;: 99 }&quot;)
  == Ok(Js.Dict.fromArray([(&quot;alice&quot;, 42), (&quot;bob&quot;, 99)]))</code></pre></aside><dl><dt class="spec value" id="val-keyValuePairs"><a href="#val-keyValuePairs" class="anchor"></a><code><span class="keyword">let</span> keyValuePairs: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(array(<span>(string, <span class="type-var">'a</span>)</span>));</code></dt></dl><aside><p>Decode a JSON value into a Rescript <code>array</code> of pair.</p><pre><code class="ml">decodeString(dict(int), &quot;{ \&quot;alice\&quot;: 42, \&quot;bob\&quot;: 99 }&quot;)
  == Ok([(&quot;alice&quot;, 42), (&quot;bob&quot;, 99)])</code></pre></aside><dl><dt class="spec value" id="val-tuple2"><a href="#val-tuple2" class="anchor"></a><code><span class="keyword">let</span> tuple2: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span>);</code></dt></dl><aside><p>Decode a JSON value into a Rescript tuple with 2 elements.</p><p>This is helpful if you're dealing with a heterogeneous JSON array, like <code>[1, &quot;hey&quot;]</code>. <em>Modeling your JSON like this is generally a bad idea.</em> Unfortunatly, we sometimes have to use JSON/JavaScript from places outside our control, hence these functions.</p><pre><code class="ml">decodeString(tuple2(int, string), &quot;[1, \&quot;hey\&quot;]&quot;) == Ok((1, &quot;hey&quot;))</code></pre></aside><aside><p>For <a href="#val-tuple3"><code>tuple3</code></a>-<a href="#val-tuple8"><code>tuple8</code></a>, the use looks just like the examples for <code>tuple2</code> just with more elements &amp; decoders.</p></aside><dl><dt class="spec value" id="val-tuple3"><a href="#val-tuple3" class="anchor"></a><code><span class="keyword">let</span> tuple3: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>)</span>);</code></dt><dt class="spec value" id="val-tuple4"><a href="#val-tuple4" class="anchor"></a><code><span class="keyword">let</span> tuple4: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>)</span>);</code></dt><dt class="spec value" id="val-tuple5"><a href="#val-tuple5" class="anchor"></a><code><span class="keyword">let</span> tuple5: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'e</span>)</span>);</code></dt><dt class="spec value" id="val-tuple6"><a href="#val-tuple6" class="anchor"></a><code><span class="keyword">let</span> tuple6: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'e</span>, <span class="type-var">'f</span>)</span>);</code></dt><dt class="spec value" id="val-tuple7"><a href="#val-tuple7" class="anchor"></a><code><span class="keyword">let</span> tuple7: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'g</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'e</span>, <span class="type-var">'f</span>, <span class="type-var">'g</span>)</span>);</code></dt><dt class="spec value" id="val-tuple8"><a href="#val-tuple8" class="anchor"></a><code><span class="keyword">let</span> tuple8: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'g</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'h</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>, <span class="type-var">'c</span>, <span class="type-var">'d</span>, <span class="type-var">'e</span>, <span class="type-var">'f</span>, <span class="type-var">'g</span>, <span class="type-var">'h</span>)</span>);</code></dt></dl></section><section><header><h3 id="obj-primatives"><a href="#obj-primatives" class="anchor"></a>Object Primatives</h3></header><dl><dt class="spec value" id="val-field"><a href="#val-field" class="anchor"></a><code><span class="keyword">let</span> field: string <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Decode a JSON object, requiring a particular field.</p><pre><code class="ml">field(&quot;x&quot;, int)-&gt;decodeString(&quot;{ \&quot;x\&quot;: 42 }&quot;)            == Ok(42)
field(&quot;x&quot;, int)-&gt;decodeString(&quot;{ \&quot;x\&quot;: 42, \&quot;y\&quot;: 50 }&quot;) == Ok(42)
field(&quot;x&quot;, int)-&gt;decodeString(&quot;{ \&quot;x\&quot;: true }&quot;)          == Error(...)
field(&quot;x&quot;, int)-&gt;decodeString(&quot;{ \&quot;y\&quot;: 50 }&quot;)            == Error(...)</code></pre><p>The object <em>can</em> have other fields. Lots of them! The only thing this decoder cares about is if <code>x</code> is present and that the value there is an <code>int</code>.</p><p>Check out <a href="#val-map2"><code>map2</code></a> to see how to decode multiple fields!</p></aside><dl><dt class="spec value" id="val-at"><a href="#val-at" class="anchor"></a><code><span class="keyword">let</span> at: string <span>=&gt;</span> array(string) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Decode a nested JSON object, requiring certain fields.</p><pre><code class="ml">let json = &quot;{ \&quot;person\&quot;: { \&quot;name\&quot;: \&quot;Maria\&quot;, \&quot;age\&quot;: 24 } }&quot;

at([&quot;person&quot;, &quot;name&quot;], string)-&gt;decodeString(json) == Ok(&quot;Maria&quot;)
at([&quot;person&quot;, &quot;age&quot; ], int   )-&gt;decodeString(json) == Ok(24)</code></pre><p>This is really just a shorthand for saying things like:</p><pre><code class="ml">field(&quot;person&quot;, field(&quot;name&quot;), string)) == at([&quot;person&quot;, &quot;name&quot;], string)</code></pre></aside><dl><dt class="spec value" id="val-index"><a href="#val-index" class="anchor"></a><code><span class="keyword">let</span> index: int <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Decode a nested JSON object, requiring a certain index.</p><pre><code class="ml">let json = &quot;[ \&quot;Maria\&quot;, \&quot;Caleb\&quot;, \&quot;Sofia\&quot; ]&quot;

index(0, string)-&gt;decodeString(json) == Ok(&quot;Maria&quot;)
index(2, string)-&gt;decodeString(json) == Ok(&quot;Sofia&quot;)</code></pre></aside></section><section><header><h3 id="inconsisent-structur"><a href="#inconsisent-structur" class="anchor"></a>Inconsistent Structure</h3></header><dl><dt class="spec value" id="val-option"><a href="#val-option" class="anchor"></a><code><span class="keyword">let</span> option: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(option(<span class="type-var">'a</span>));</code></dt></dl><aside><p>Helpful for dealing with optional fields. Here are a few slightly different examples:</p><pre><code class="ml">let json = &quot;{ \&quot;name\&quot;: \&quot;Maria\&quot;, \&quot;age\&quot;: 24 }&quot;

option(field(&quot;age&quot;,    int  ))-&gt;decodeString(json) == Ok(Some(24))
option(field(&quot;name&quot;,   int  ))-&gt;decodeString(json) == Ok(None)
option(field(&quot;height&quot;, float))-&gt;decodeString(json) == Ok(None)

field(&quot;age&quot;,    option(int  ))-&gt;decodeString(json) == Ok(Some(24))
field(&quot;name&quot;,   option(int  ))-&gt;decodeString(json) == Ok(None)
field(&quot;height&quot;, option(float))-&gt;decodeString(json) == Error(...)</code></pre><p>Notice the last example! It is saying we <em>must</em> have a field named <code>height</code> and the content <em>may</em> be a <code>float</code>. There is no <code>height</code> field, so the decoder fails.</p><p>Point is, <code>option</code> will make exactly what it contains conditional. For optional fields, this means you probably want it <em>outside</em> a use of <code>field</code> or <code>at</code>.</p></aside><dl><dt class="spec value" id="val-oneOf"><a href="#val-oneOf" class="anchor"></a><code><span class="keyword">let</span> oneOf: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> array(<a href="#type-t">t</a>(<span class="type-var">'a</span>)) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Try a bunch of different decoders. This can be useful if the JSON may come in a couple different formats. For example, say you want to read an array of numbers, but some of them are <code>null</code>.</p><pre><code class="ml">let badIntDecoder: t&lt;int&gt; =
  oneOf(
    int, // the first decoder to try
    [null(0)] // the other decoders to try
  )

decodeString(badIntDecoder, &quot;[1,2,null,4]&quot;) == Ok([1, 2, 0, 4])</code></pre><p>Why would someone generate JSON like this? Questions like this are not good for your health. Point is, that you can use <code>oneOf</code> to handle situations like this!</p><p>You could also use <code>oneOf</code> to help version your data. Try the latest format, then a few older ones that you still support. You could use <a href="#val-andThen"><code>andThen</code></a> to be even more particular if you wanted.</p></aside></section><section><header><h3 id="run-decoders"><a href="#run-decoders" class="anchor"></a>Run Decoders</h3></header><dl><dt class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><code><span class="keyword">type</span> <span class="keyword">nonrec</span> value</code><code> = Js.Json.t</code>;</dt></dl><aside><p>Represents a JavaScript value.</p></aside><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code><code> = </code><table class="variant"><tr id="type-error.Failure" class="anchored"><td class="def constructor"><a href="#type-error.Failure" class="anchor"></a><code>| </code><code><span class="constructor">Failure</span>(string, <a href="#type-value">value</a>)</code></td></tr><tr id="type-error.Index" class="anchored"><td class="def constructor"><a href="#type-error.Index" class="anchor"></a><code>| </code><code><span class="constructor">Index</span>(int, <a href="#type-error">error</a>)</code></td></tr><tr id="type-error.Field" class="anchored"><td class="def constructor"><a href="#type-error.Field" class="anchor"></a><code>| </code><code><span class="constructor">Field</span>(string, <a href="#type-error">error</a>)</code></td></tr><tr id="type-error.OneOf" class="anchored"><td class="def constructor"><a href="#type-error.OneOf" class="anchor"></a><code>| </code><code><span class="constructor">OneOf</span>(<a href="#type-error">error</a>, array(<a href="#type-error">error</a>))</code></td></tr></table>;</dt></dl><aside><p>A structured error describing exactly how the decoder failed. You can use this to create more elaborate visualizations of a decoder problem. For example, you could show the entire JSON object and show the part causing the failure in red.</p></aside><dl><dt class="spec value" id="val-decodeString"><a href="#val-decodeString" class="anchor"></a><code><span class="keyword">let</span> decodeString: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> string <span>=&gt;</span> Pervasives.result<span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span>;</code></dt></dl><aside><p>Parse the given string into a JSON value and then run the decoder on it. This will fail if the string is not well-formed JSON or if the Decoder fails for some reason.</p><pre><code class="ml">decodeString(int, &quot;1&quot;)    == Ok(1)
decodeString(int, &quot;1 + 2&quot;) == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-decodeValue"><a href="#val-decodeValue" class="anchor"></a><code><span class="keyword">let</span> decodeValue: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-value">value</a> <span>=&gt;</span> Pervasives.result<span>(<span class="type-var">'a</span>, <a href="#type-error">error</a>)</span>;</code></dt></dl><aside><p>Run a decoder on some JSON `value`. This is helpful if you want to bring in some JavaScript value as a `value`, then run a decoder on it.</p><pre><code class="ml">@module(&quot;my-func&quot;)
external getUser: unit =&gt; value = &quot;default&quot;

let firstNameDecoder: t&lt;string&gt; =
  oneOf(
    field(&quot;firstName&quot;, string),
    [
      field(&quot;first_name&quot;, string),
      field(&quot;first-name&quot;, string),
    ]
  )

let myFunc = () =&gt; {
  let val = getUser()
  decodeValue(firstNameDecoder, val)
}</code></pre></aside><dl><dt class="spec value" id="val-errorToString"><a href="#val-errorToString" class="anchor"></a><code><span class="keyword">let</span> errorToString: <a href="#type-error">error</a> <span>=&gt;</span> string;</code></dt></dl><aside><p>Convert a decoding error into a <code>string</code> that is nice for debugging. The output of this function produces a multi-line string.</p><p>For example, the following decoder</p><pre><code class="ml">at(&quot;a&quot;, [&quot;b&quot;], int)-&gt;decodeString(`{ &quot;a&quot;: { &quot;b&quot;: &quot;hey&quot; } }`)</code></pre><p>produces</p><pre>Problem with the value at json[&quot;a&quot;][&quot;b&quot;]:

&quot;hey&quot;

Expecting an INT</pre><p><b>Note</b>: It would be cool to do nicer coloring, but for now I'm just keeping it simple. It is totally possible to crawl the <code>error</code> variant and create this separately though! You can always checkout the source to see how this function works.</p></aside></section><section><header><h3 id="combine"><a href="#combine" class="anchor"></a>Combine</h3><p>Note: If you run out of map functions, take a look at <a href="#val-andMap"><code>andMap</code></a> which makes it easier to handle large objects, but produces lower quality type errors.</p></header><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">let</span> map: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>);</code></dt></dl><aside><p>Transform a decoder. Maybe you just want to know the length of a string:</p><pre><code class="ml">let stringLength: t&lt;int&gt; = map(int, ~f=Js.Array.length)</code></pre><p>It is often helpful to use <code>map</code> with <a href="#val-oneOf"><code>oneOf</code></a>, like when defining <a href="#val-nullable"><code>nullable</code></a>:</p><pre><code class="ml">let nullable = (decoder: t&lt;'a&gt;): t&lt;option&lt;'a&gt;&gt; =
  oneOf(
    null(None),
    [map(decoder, ~f=val =&gt; Some(val))]
  )</code></pre></aside><dl><dt class="spec value" id="val-map2"><a href="#val-map2" class="anchor"></a><code><span class="keyword">let</span> map2: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>);</code></dt></dl><aside><p>Try two decoders and then combine the result. We can use this to decode objects with many fields:</p><pre><code class="ml">type point = { x: float, y: float }

let pointDecoder =
  map2(
    field(&quot;x&quot;, float),
    field(&quot;y&quot;, float),
    ~f=(x, y) =&gt; { x: x, y: y })
  )

decodeString(pointDecoder, &quot;{ \&quot;x\&quot;: 2, \&quot;y\&quot;: 5 }&quot;) == Ok({ x: 2, y: 5 })</code></pre><p>It tries each individual decoder and puts the result together with in the <code>~f</code> function.</p></aside><dl><dt class="spec value" id="val-map3"><a href="#val-map3" class="anchor"></a><code><span class="keyword">let</span> map3: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt></dl><aside><p>Try three decoders and then combine the result. We can use this to decode objects with many fields:</p><pre><code class="ml">type person = { name: string, age: int, height: float }

let pointDecoder =
  map2(
    field(&quot;name&quot;, string),
    at(&quot;info&quot;, [&quot;age&quot;], int),
    at(&quot;info&quot;, [&quot;height&quot;], float),
    ~f=(name, age, height) =&gt; { name: name, age: age, height: height })
  )

decodeString(pointDecoder, &quot;{ \&quot;name\&quot;: &quot;Maria&quot;, \&quot;info\&quot;: { \&quot;age\&quot;: 28, \&quot;height\&quot;: 1.5 } }&quot;)
  == Ok({ name: &quot;Maria&quot;, age: 28, height: 1.5 })</code></pre><p>It tries each individual decoder and puts the result together with in the <code>~f</code> function.</p></aside><aside><p>For <a href="#val-map4"><code>map4</code></a>-<a href="#val-map8"><code>map8</code></a>, the use looks just like the examples for <a href="#val-map2"><code>map2</code></a> and <a href="#val-map3"><code>map3</code></a> just with more elements &amp; decoders.</p></aside><dl><dt class="spec value" id="val-map4"><a href="#val-map4" class="anchor"></a><code><span class="keyword">let</span> map4: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'d</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt><dt class="spec value" id="val-map5"><a href="#val-map5" class="anchor"></a><code><span class="keyword">let</span> map5: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'d</span> <span>=&gt;</span> <span class="type-var">'e</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt><dt class="spec value" id="val-map6"><a href="#val-map6" class="anchor"></a><code><span class="keyword">let</span> map6: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'d</span> <span>=&gt;</span> <span class="type-var">'e</span> <span>=&gt;</span> <span class="type-var">'f</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt><dt class="spec value" id="val-map7"><a href="#val-map7" class="anchor"></a><code><span class="keyword">let</span> map7: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'g</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'d</span> <span>=&gt;</span> <span class="type-var">'e</span> <span>=&gt;</span> <span class="type-var">'f</span> <span>=&gt;</span> <span class="type-var">'g</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt></dl><dl><dt class="spec value" id="val-map8"><a href="#val-map8" class="anchor"></a><code><span class="keyword">let</span> map8: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'c</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'d</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'e</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'f</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'g</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'h</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span> <span>=&gt;</span> <span class="type-var">'c</span> <span>=&gt;</span> <span class="type-var">'d</span> <span>=&gt;</span> <span class="type-var">'e</span> <span>=&gt;</span> <span class="type-var">'f</span> <span>=&gt;</span> <span class="type-var">'g</span> <span>=&gt;</span> <span class="type-var">'h</span> <span>=&gt;</span> <span class="type-var">'val</span>)</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'val</span>);</code></dt></dl></section><section><header><h3 id="fancy"><a href="#fancy" class="anchor"></a>Fancy</h3></header><dl><dt class="spec value" id="val-value"><a href="#val-value" class="anchor"></a><code><span class="keyword">let</span> value: <a href="#type-t">t</a>(<a href="#type-value">value</a>);</code></dt></dl><aside><p>Do not do anything with a JSON value, just bring it into Rescript as a <code>value</code>. This can be useful if you have particularly complex data that you would like to deal with later. Or if you are going to send it out another <code>external</code> and do not care about its structure.</p></aside><dl><dt class="spec value" id="val-null"><a href="#val-null" class="anchor"></a><code><span class="keyword">let</span> null: <span class="type-var">'a</span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Decode a JSON string into some Rescript value.</p><pre><code class="ml">decodeString(null(false), &quot;null&quot;) == Ok(false)
decodeString(null(42), &quot;null&quot;)    == Ok(42)
decodeString(null(42), &quot;42&quot;)      == Error(...)
decodeString(null(42), &quot;false&quot;)   == Error(...)</code></pre></aside><dl><dt class="spec value" id="val-succeed"><a href="#val-succeed" class="anchor"></a><code><span class="keyword">let</span> succeed: <span class="type-var">'a</span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Ignore the JSON and produce a certain Elm value.</p><pre><code class="ml">decodeString(succeed(42), &quot;true&quot;)    == Ok(42)
decodeString(succeed(42), &quot;[1,2,3]&quot;) == Ok(42)
decodeString(succeed(42), &quot;hello&quot;)   == Error(...) // &quot;hello&quot; is not a valid JSON string, so this fails</code></pre></aside><dl><dt class="spec value" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span class="keyword">let</span> fail: string <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>);</code></dt></dl><aside><p>Ignore the JSON and make the decoder fail. This is handy when used with <a href="#val-oneOf"><code>oneOf</code></a> or <a href="#val-andThen"><code>andThen</code></a> where you want to give a custom error message in some case.</p><p>See the <a href="#val-andThen"><code>andThen</code></a> docs for an example.</p></aside><dl><dt class="spec value" id="val-andMap"><a href="#val-andMap" class="anchor"></a><code><span class="keyword">let</span> andMap: <a href="#type-t">t</a>(<span>(<span class="type-var">'a</span> <span>=&gt;</span> <span class="type-var">'b</span>)</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>);</code></dt></dl><aside><p>Chain decoders together and then transfrom them all together. This is very often going to be used with <a href="#val-succeed"><code>succeed</code></a>.</p><p>If you want to define <a href="#val-map3"><code>map3</code></a>, you could do:</p><pre><code class="ml">let map3: (t&lt;'a&gt;, t&lt;'b&gt;, t&lt;'c&gt;, ~f: ('a, 'b, 'c) =&gt; 'val) =&gt; t&lt;'val&gt; = (
  decoderA,
  decoderB,
  decoderC,
  ~f,
) =&gt;
  succeed(f)
    -&gt;andMap(decoderA)
    -&gt;andMap(decoderB)
    -&gt;andMap(decoderC)</code></pre></aside><dl><dt class="spec value" id="val-andThen"><a href="#val-andThen" class="anchor"></a><code><span class="keyword">let</span> andThen: <a href="#type-t">t</a>(<span class="type-var">'a</span>) <span>=&gt;</span> <span>f:<span>(<span class="type-var">'a</span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>))</span></span> <span>=&gt;</span> <a href="#type-t">t</a>(<span class="type-var">'b</span>);</code></dt></dl><aside><p>Create decoders that depend on previous results. If you are creating versioned data, you might do something like this:</p><pre><code class="ml">let infoDecoder1: t&lt;info&gt; = ...
let infoDecoder2: t&lt;info&gt; = ...
let infoDecoder3: t&lt;info&gt; = ...

let infoHelp = (version: int): t&lt;info&gt; =
  switch version {
  | 1 =&gt; infoDecoder1
  | 2 =&gt; infoDecoder2
  | 3 =&gt; infoDecoder3
  | _ =&gt; fail(`Trying to decode info, but version ${Belt.Int.toString(version)} is not supported`)
  }

let info: t&lt;info&gt; =
  field(&quot;version&quot;, int)
    -&gt;andThen(~f=infoHelp)</code></pre></aside></section></section></div></body></html>